tmux_dir="~/.config/tmux"

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'

set -g @plugin 'tmux-plugins/tmux-yank'
# Persists tmux environment across system restarts
set -g @plugin 'tmux-plugins/tmux-resurrect'
# Checks internet connection!
set -g @plugin 'tmux-plugins/tmux-online-status'

# Continuous saving of tmux environment - MUST BE LAST
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @resurrect-dir "$tmux_dir/resurrect"
set -g @resurrect-save 'S'                          # Save the session
set -g @resurrect-restore 'R'                       # Reload the session
# Automatically restore the last saved session on startup
set -g @continuum-restore 'on'                     # Last saved session is always restored

# -- THEMES --
# set -g @plugin 'catppuccin/tmux'
# set -g @plugin 'rose-pine/tmux'
# set -g @plugin "nordtheme/tmux"
# set -g @plugin "janoamaral/tokyo-night-tmux"

# -- Window Title Configuration --
# Show current directory in window titles with separators and more refined color schemes
# set-window-option -g window-status-format "#[fg=#839496]#{?pane_in_mode,#[bg=#586e75] ,}#[fg=#93a1a1]#{?pane_active,#[fg=#268bd2] ,}#{?pane_active,#[bold] ,}#(basename #{pane_current_path})"
# set-window-option -g window-status-current-format "#[fg=#268bd2][bold]#{?pane_in_mode,#[bg=#586e75] ,}#(basename #{pane_current_path})#[fg=#839496]"

# -- Window Separation Styling --
# Add refined separators for clarity and elegance
set -g @separator "┃"
set -g @separator-left "┃"
set -g @separator-right "┃"

# Set the left status bar with the directory and some space after it
set-option -g status-left "#[fg=#a6e3a1,bold]#{@separator-green} #[fg=#cdd6f4,bold] #S #[fg=#89b4fa]#{@separator-blue} | #[fg=#f28fad]#(pwd) |    "

# Add padding between the window list
set-window-option -g window-status-format "   #[fg=#cdd6f4]#I: #W #[fg=#89b4fa]#{@separator-blue}"
set-window-option -g window-status-current-format "   #[fg=#f28fad,bold]#I: #W #[fg=#89b4fa]#{@separator-blue}"


# -- Active Window Styling --
# Highlight active window with subtle contrast to make it stand out
set-window-option -g window-status-current-style "fg=#268bd2,bold"

# -- Automatically Renaming Windows --
setw -g automatic-rename on  # Automatically rename windows to reflect the current directory or process running

# -- Status Bar with Refined Colors --
# A clean status bar with cool contrast for a chill vibe
set-option -g status-right "#[fg=#2aa198]#{?pane_in_mode,#[bg=#93a1a1] ,}#[fg=#268bd2]#{?pane_active,#[fg=#268bd2] ,}#(basename #{pane_current_path})#[fg=#93a1a1]#{@separator} #{=21:hh:mm} %a, %Y-%m-%d #[fg=#93a1a1]#{@separator}#{=21:hh:mm} %H:%M"

# -- Status Bar Color and Background --
# Set background color and text color for the status bar for a chill and clean aesthetic
set-option -g status-style "bg=#002b36,fg=#93a1a1"  # Dark background with soft text color

# -- Refined Pane Borders with Contrast --
# Use clean pane borders with high contrast to clearly distinguish between panes
set-option -g pane-border-style "fg=#586e75"
set-option -g pane-active-border-style "fg=#268bd2"

# -- Refresh Interval for the Status Bar --
# Ensures the status bar updates periodically
set-option -g status-interval 1

# -- Left bar

# # --- Left Side: Session Name and Windows ---
set-option -g status-left "#[fg=#a6e3a1,bold]#{@separator-green}#[fg=#cdd6f4,bold] #S #[fg=#89b4fa]#{@separator-blue}"
set-window-option -g window-status-format "#[fg=#cdd6f4] #I: #W #[fg=#89b4fa]#{@separator-blue}"
set-window-option -g window-status-current-format "#[fg=#f28fad,bold] #I: #W #[fg=#89b4fa]#{@separator-blue}"

# # Highlight active window with bold and different color
set-window-option -g window-status-current-style "fg=#89b4fa,bold"

# ---
set-option -g status-left-length 50          # Ensure enough space for the left side
set-option -g status-right-length 50         # Avoid overlaps with the right side

# Left side: session name with padding and separators
set-option -g status-left "#[fg=#a6e3a1,bold]#{@separator-green} #[fg=#cdd6f4,bold] #S #[fg=#89b4fa]#{@separator-blue}   "

# Windows: Add consistent padding before window names
set-window-option -g window-status-format "   #[fg=#cdd6f4]#I: #W #[fg=#89b4fa]#{@separator-blue}"
set-window-option -g window-status-current-format "   #[fg=#f28fad,bold]#I: #W #[fg=#89b4fa]#{@separator-blue}"
# ---

# Catpuccin
set -g @catppuccin_flavour "mocha"
set -g @catppuccin_status_left_separator "null"
set -g @catppuccin_status_modules_right "application session date_time"
set -g @catppuccin_session_icon "null"
set -g @catppuccin_application_icon "null"
set -g @catppuccin_date_time_icon "null"

# Configure Catppuccin
set -g @catppuccin_flavor "macchiato"
set -g @catppuccin_status_background "none" # none == default
set -g @catppuccin_pane_status_enabled "off"
set -g @catppuccin_pane_border_status "off"

set -g @catppuccin_window_default_text "#{b:pane_current_path}"
set -g @catppuccin_window_current_text "#{b:pane_current_path}"

# Show current directory in window name
set-window-option -g window-status-format "#(pwd)"
set-window-option -g window-status-current-format "#(pwd)"

# Use 256 colors
set-option -g default-terminal "screen-256color"

# Status bar refresh interval
set-option -g status-interval 1

# Enable the status bar
set-option -g status on

# Removes left side [ <session-name> ]
set-option -g status-left "#[fg=#a6e3a1,bold]#{@separator-green} #[fg=#cdd6f4,bold] #[fg=#89b4fa]#{@separator-blue}   "
set-option -g status-left "#[fg=#a6e3a1,bold]#{@separator-green} #[fg=#cdd6f4,bold] #(basename $(tmux display-message -p '#{pane_current_path}')) #[fg=#89b4fa]#{@separator-blue}"


# --- Catppuccin Colors ---
# Status bar background and foreground colors
set-option -g status-style "bg=#1e1e2e,fg=#cdd6f4"

# Left side window details (show current directory only)
# set-window-option -g window-status-format "#{b:pane_current_path##*/}"
# set-window-option -g window-status-current-format "#{b:pane_current_path##*/}"

# --- Clean Separators ---
# Define refined separator bars using Unicode characters and Catppuccin colors
set -g @separator-pink "┃"
set -g @separator-green "┃"
set -g @separator-blue "┃"

# --- Right Side: Custom Layout ---
# Right side: [ <session-name ]
#[fg=#a6e3a1]#{@separator-green}#[fg=#cdd6f4,bold] [#S] \
# --- session name end
set-option -g status-right "#[fg=#f28fad]#{@separator-pink}#[fg=#cdd6f4] #(basename $(tmux display-message -p '#{pane_current_command}' 2>/dev/null)) \
#[fg=#a6e3a1]#{@separator-green}#[fg=#cdd6f4,bold] [#S] \
#[fg=#89b4fa]#{@separator-blue}#[fg=#cdd6f4] #{=21:hh:mm} %a, %Y-%m-%d #[fg=#cdd6f4] %H:%M"

# --- Pane Borders ---
# Pane border colors for better clarity
set-option -g pane-border-style "fg=#585b70"
set-option -g pane-active-border-style "fg=#f28fad"

# --- Oh-My-Zsh Compatibility ---
if-shell 'test -n "$TMUX"' 'set-option -g default-terminal "screen-256color"' ''

# Set the window titles to the current working directory
set-window-option -g window-status-format "#(basename #{pane_current_path})"   # Shows only the directory name, not the full path
set-window-option -g window-status-current-format "#(basename #{pane_current_path})"   # For the current window
# Automatically rename windows to show the current directory in each pane
setw -g automatic-rename on
# Ensure tmux tracks pane_current_path and updates the window title accordingly
set-option -g update-environment "pane_current_path"
# Set the status bar refresh interval to a low value to ensure the title updates frequently
set-option -g status-interval 1



# Internet connection icon fallback
set -g @online_icon "ok"
set -g @offline_icon "offline!"

# Leader key: ctrl+space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Switch windows: Shift+Alt+{h or l}
bind -n M-K previous-window
bind -n M-J next-window

# Catppuccin theme flavors
set -g @catppuccin_flavour 'mocha' # or frappe, macchiato, mocha
# Rose Pine theme
# set -g @rose_pine_variant 'dawn' # Options are 'main', 'moon' or 'dawn'

# Tokyo Night Theme
# set -g @tokyo-night-tmux_window_id_style digital
# set -g @tokyo-night-tmux_pane_id_style hsquare
# set -g @tokyo-night-tmux_zoom_id_style dsquare

# Resolve NVIM color scheme when opening in TMUX
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Nvim yank
set-window-option -g mode-keys vi
# Keybindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Horizontal split: leader + -
bind - split-window -vc "#{pane_current_path}"
# Vertical split: leader + |
bind | split-window -hc "#{pane_current_path}"

# Trigger goto.sh - leader+o
bind-key o run-shell "tmux send-keys -t . 'bash ~/.config/tmux/goto.sh' Enter"

# Rename current window: Leader + r
bind r command-prompt "rename-window %%"

# Switch between sessions: Leader + s
bind s choose-tree -Z

run '~/.tmux/plugins/tpm/tpm'
